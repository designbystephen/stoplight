<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stoplight - A Peaceful work at home assistant</title>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"
    />
    <style>
        *,
        *::after,
        *::before {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        .stoplight {
            height: 100vh;
            width: 100vw;
            color: #fff;
            display: flex;
            align-content: center;
        }
        .stoplight-text {
            flex-grow: 1;
            text-align: center;
            text-transform: uppercase;
            font-size: 22rem;
            user-select: none;
            margin: auto;
            text-shadow: 3px 5px rgba(0,0,0,0.33);
        }

        .stoplight--free {
            background-color: #2ecc71;
        }

        .stoplight--waiting {
            background-color: #f1c40f;
        }

        .stoplight--busy {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <div class="stoplight">
        <h2 class="stoplight-text animate__animated"></h2>
    </div>
    <script>
        const animations = [
            'bounce',
            'flash',
            'pulse',
            'rubberBand',
            'shakeX',
            'shakeY',
            'headShake',
            'swing',
            'tada',
            'wobble',
            'jello',
            'heartBeat',
        ];

        const stages = [
            'free',
            'waiting',
            'busy',
        ];

        let currentStage = 0;

        const stopLight = document.querySelector('.stoplight');
        const stopLightText = document.querySelector('.stoplight-text');

        const setStage = (stage) => {
            let nextStage = stage;

            // allow for rollover and cover out of bounds
            if(stage < 0) nextStage = 0;
            if(stage >= stages.length) nextStage = 0;

            // set current stage
            currentStage = nextStage;
        }

        const incrementStage = () => setStage(currentStage + 1);

        const stripClassModifiers = () => {
            stages.forEach(stage => {
                stopLight.classList.remove(`stoplight--${stage}`);
            });
            animations.forEach(animation => {
                stopLightText.classList.remove(`animate__${animation}`);
            });
        }

        const addRandomAnimation = () => {
            const animationIndex = Math.floor(Math.random()*(animations.length - 0 + 1) + 0);
            stopLightText.classList.add(`animate__${animations[animationIndex] || animations[0]}`);
        }

        const changeStage = () => {
            stripClassModifiers();
            stopLight.classList.add(`stoplight--${stages[currentStage]}`);
        }

        const changeText = () => stopLightText.textContent = stages[currentStage];

        const updateStageContent = () => {
            changeStage();
            changeText();
            addRandomAnimation();
        }

        stopLight.addEventListener('click', () => {
            incrementStage();
            updateStageContent();
        });

        (() => {
            setStage(0);
            updateStageContent();
        })();
    </script>
</body>
</html>
